
use v6.d;
use lib 'lib';
use lib 'app';

use models;
use Test;

plan 12;

%*ENV<DISABLE-SQL-LOG> = True;

my Client $client;

$client = Client.build({});
ok $client.is-invalid;
ok $client.errors.email == ['at least 5 characters required', 'must be present', 'must be confirmed'];

$client = Client.build({email => 'fred@aol.com'});
ok $client.is-invalid;
ok $client.errors.email == ['must be confirmed'];

$client = Client.build({email => 'fred@aol.com', email_confirmation => 'fred@aol.com'});
ok $client.is-valid;
nok $client.errors.email;

$client = Client.create({});
ok $client.is-invalid;
ok $client.errors.email == ['at least 5 characters required', 'must be present', 'must be confirmed'];

$client = Client.create({email => 'fred@aol.com'});
ok $client.is-invalid;
ok $client.errors.email == ['must be confirmed'];

$client = Client.create({email => 'fred@aol.com', email_confirmation => 'fred@aol.com'});
ok $client.is-valid;
nok $client.errors.email;
